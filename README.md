# micro-wave
项目名称： 基于 FreeRTOS 的智能微波炉控制系统
项目平台： STM32F103C8T6 + FreeRTOS + Keil
项目时间： 2025.03–2025.07
关键词： FreeRTOS、任务调度、二值信号量、DMA、IAP固件升级

项目描述：
本项目模拟实现一款功能完善的嵌入式微波炉控制系统，基于 STM32F103C8T6 平台，采用 FreeRTOS 实时操作系统进行任务管理与调度，结合串口 DMA 通信与 IAP 固件升级机制，具备加热控制、门控检测、按键操作、中断响应、LCD显示、DHT11温度监测、蜂鸣器报警等完整功能模块，体现了多任务协作、系统资源管理与底层驱动开发的能力。

主要功能与实现：

使用 FreeRTOS 多任务管理：设计多个任务（按键检测、加热控制（次高优先级）、温湿度监测、IAP升级(最高优先级)等），合理分配优先级，实现任务并发与协调。
设计分层状态机管理设备运行状态（待机/时间设置/功率设置/），以实现单按键多功能切换需求。
利用二值信号量与中断机制实现任务间同步与响应（如TIM4定时器更新中断给加热任务释放信号量）。
显示模块采用LCD屏幕实时反馈状态（门开关、加热中、温度等），并使用蜂鸣器进行声音提示。
通过USART +DMA + Bootloader 实现 IAP在线升级机制，支持通过串口接收完整bin文件并写入 Flash 自动跳转运行。

Freertos内核裁剪方面：freertosconfig.h里面设置，比如设置CPU频率为72MHz，第二个是tick即时钟节拍频率（滴答定时器）：设置为1000Hz,就是1ms一个节拍，第三个设置允许动态那个宏，设置为允许动态申请内存，第四个比如优先级分组，RTOS不支持子优先级，所以设置为4，第五个设置Freertos可以管理的最大中断优先级设置为3，即高于3的中断优先级不能被屏蔽，d第六个配置pendSV_handler中断那个宏，目的是与STM32文件适配

流程：
# 微波炉演示系统功能需求
## 一、初始状态
1. **LCD显示**：STM32初始化后显示欢迎界面（如"Microwave Demo"），持续2秒后进入待机模式
2. **LED状态**：内部LED灯亮（模拟门未关闭时的照明）
3. **能耗状态**：舵机能耗处于"开门"位置（角度0°，门锁未闭合）
## 二、用户操作流程
1. **关门操作**
   - 第一次按下KEY1关门
   - SG90旋转90°代表关闭
   - LED灯熄灭
2. **默认显示**
   - LCD显示：倒计时0s，功率档位Medium
3. **参数设置**
   - 短按KEY2开始设置倒计时，LCD显示"time setting"
   - 再次短按KEY2循环增加倒计时（每次+20s，最大200s）
   - 长按KEY2切换至功率设置，LCD显示"Power setting"
   - 短按KEY2循环切换档位（low/medium/high）
   - 再次长按KEY2返回时间设置

4. **启动加热**
   - 长按KEY1启动加热
   - 功能启动后：
     1. PWM控制加热片工作
     2. 转盘（SG90模拟）以恒定速度旋转
     3. 蜂鸣器短鸣"滴滴"
     4. LCD显示倒计时
     5. DHT11实时显示温度
     6. LCD显示"Heating"状态
5. **加热完成**
   - 倒计时归零时：
     1. 加热片断电
     2. 转盘停止
     3. 蜂鸣器短鸣"滴滴滴"
     4. LCD显示最终时间和温度
     5. 显示"Completed"状态
   - 门自动打开，LED亮起
   - LCD恢复默认时间和档位显示

## 三、异常情况处理
1. **加热过程中断**
   - 按下KEY1开门时：
     1. 加热片断电
     2. 转盘停止
     3. LED亮起
     4. LCD显示暂停倒计时和"Heating stopped!"
2. **恢复加热**
   - 按下KEY1关门（LED熄灭）
   - 需长按KEY1重新启动并继续倒计时
3. **温度过高**
   - DHT11检测超温时：
     1. 加热片断电
     2. 转盘停止
     3. LED亮起，门自动打开
     4. 蜂鸣器鸣响"滴滴滴滴"
     5. LCD显示"Heating stopped!"
4. **门未关闭启动**
   - 蜂鸣器短鸣
   - 加热片和转盘不工作
   - LCD显示"Close door first"
## 四、固件更新功能
1. 通过串口接收APP固件
2. 编写Bootloader任务，将APP从RAW写入Flash
3. 实现Flash分页擦写
4. 设置SP及PC寄存器，重定向中断向量表
5. 跳转到APP程序执行

